---
  - hosts: localhost
    vars:
      - openstack_ansible_major: ussuri
      - openstack_ansible_tag: 21.0.1
      - openstack_env: production
    tasks:
        - name: Build openstack ansible master docker image
          docker_image:
            build:
                path: "./openstack-ansible-{{openstack_ansible_major}}/"
            pull: yes
            name: "ansible-master-{{openstack_ansible_major}}"
            tag: "{{openstack_ansible_tag}}"
            #push: yes
            source: build

        - name: Run ansibe-master container
          docker_container:
            name: "ansible-master-{{openstack_ansible_major}}-{{openstack_env}}"
            image: "ansible-master-{{openstack_ansible_major}}-{{openstack_env}}:{{openstack_ansible_tag}}"
            state: 'started'
            volumes:
                - ./production/openstack-config/:/etc/openstack_deploy/
                - ./production/secrets/ssh:/root/.ssh/
                - ./production/secrets/ceph-keyring:/etc/openstack/ceph-keyring/
                - ./production/root:/root/